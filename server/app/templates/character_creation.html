<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Character creation</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/character_creation_style.css') }}">

    <script>
    $(document).ready(function(){
        classes_fields = {{ classes|tojson }};

        // Bind each input field with the character_creation_form.
        $(":input").each(function() {
            $(this).attr("form", "character_creation_form");
        });

        $("#dclass").change(function(){
            var jclass = classes_fields[$(this).val().toLowerCase()];
            $("#master").empty();

            if(jclass.hasOwnProperty('armor')) {
                $("#armor").empty();
                var jarmor = jclass['armor']
                jQuery.each(jarmor, function(i, armor) {
                    var armor_string = armor.replace("_", " ");

                    var option = $('<option></option>').attr("value", armor).text(armor_string);
                    $("#armor").append(option);
                    $("label[for='armor']").show();
                    $("#armor").show();
                });
            }
            else {
                $("label[for='armor']").hide();
                $("#armor").hide();
            }

            if(jclass.hasOwnProperty('main_weapon')) {
                $("#main_weapon").empty();
                var jmain_weapons = jclass['main_weapon']
                jQuery.each(jmain_weapons, function(i, main_weapon) {
                    var main_weapon_string = main_weapon.replace("_", " ");

                    var option = $('<option></option>').attr("value", main_weapon).text(main_weapon_string);
                    $("#main_weapon").append(option);
                    $("label[for='main_weapon']").show();
                    $("#main_weapon").show();
                });
            }
            else {
                $("label[for='main_weapon']").hide();
                $("#main_weapon").hide();
            }

            if(jclass.hasOwnProperty('secondary_weapon')) {
                $("#secondary_weapon").empty();
                var jsecondary_weapons = jclass['secondary_weapon']
                jQuery.each(jsecondary_weapons, function(i, secondary_weapon) {
                    var secondary_weapon_string = secondary_weapon.replace("_", " ");

                    var option = $('<option></option>').attr("value", secondary_weapon).text(secondary_weapon_string);
                    $("#secondary_weapon").append(option);
                    $("label[for='secondary_weapon']").show();
                    $("#secondary_weapon").show();
                });
            }
            else {
                $("label[for='secondary_weapon']").hide();
                $("#secondary_weapon").hide();
            }

            if(jclass.hasOwnProperty('pack')) {
                $("#pack").empty();
                var jpacks = jclass['pack']
                jQuery.each(jpacks, function(i, pack) {
                    var pack_string = pack.replace("_", " ");

                    var option = $('<option></option>').attr("value", pack).text(pack_string);
                    $("#pack").append(option);
                    $("label[for='pack']").show();
                    $("#pack").show();
                });
            }
            else {
                $("label[for='pack']").hide();
                $("#pack").hide();
            }

            if(jclass.hasOwnProperty('selectable_fields')) {
                if ($("#dclass").val().toLowerCase() == 'cleric') {
                    $("#fighting_style-div").hide();
                    $("#material-div").hide();
                    $("#divine_domain-div").show()
                }
                else if ($("#dclass").val().toLowerCase() == 'fighter') {
                    $("#material-div").hide();
                    $("#divine_domain-div").hide();
                    $("#fighting_style-div").show();
                }
                else if ($("#dclass").val().toLowerCase() == 'wizard') {
                    $("#fighting_style-div").hide();
                    $("#divine_domain-div").hide();
                    $("#material-div").show();
                }
            }

            $("#cantrips").empty();
            var jcantrips = jclass['cantrips']
            jQuery.each(jcantrips, function(i, cantrip) {
                var cantrip_string = cantrip['name'].replace("_", " ");

                var option = $('<option></option>').attr("value", cantrip['name']).text(cantrip_string);
                $("#cantrips").append(option);
                $("#cantrips").show();
                $("label[for='cantrips']").show();
            });

            if ($("#dclass").val().toLowerCase() == 'fighter') {
                $("#cantrips").hide();
                $("label[for='cantrips']").hide();
            }
        });
        $("#dclass").trigger('change');
    });
    </script>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <p>Character Sheet</p>
                {% if error %}
                    <p class=error><strong>Error:</strong> {{ error }}
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="intro">
                        {% for field in character_creation_form %}
                            {% if field.name in ['characterName', 'race', 'dclass', 'divine_domain', 'fighting_style', 'level', 'alignment'] %}
                                <div id="{{ field.name + '-div'}}" class="intro-div">    
                                    {{ field.label}}{{ field }}
                                </div>
                            {% endif %}
                        {% endfor %}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <p>Ability scores</p>
                <div class="ability_scores">
                        {% for field in character_creation_form %}
                            {% if field.name in ['strength', 'dexterity', 'constitution', 'wisdom', 'charisma', 'intelligence'] %}
                                <div id="{{ field.name + '-div'}}" class="ability_scores-div">    
                                    {{ field.label}}{{ field }}
                                </div>
                            {% endif %}
                        {% endfor %}
                </div>
            </div>

            <div class="col-sm-6">
                <p>Skills</p>
                <div class="skills">
                        {% for field in character_creation_form %}
                            {% if field.name in  ['athletics', 'acrobatics', 'sleight_of_hand', 'stealth', 'arcana', 'history', 'investigation', 'nature', 'religion'] %}
                                <div id="{{ field.name + '-div'}}" class="skills-div">
                                    {{ field }}{{ field.label }}
                                </div>
                            {% endif %}
                        {% endfor %}
                </div>
                <div class="skills">
                        {% for field in character_creation_form %}
                            {% if field.name in  ['animal_handling', 'insight', 'medicine', 'perception', 'survival', 'deception', 'intimidation', 'performance', 'persuasion'] %}
                                <div id="{{ field.name + '-div'}}" class="skills-div">
                                    {{ field }}{{ field.label }}
                                </div>
                            {% endif %}
                        {% endfor %}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                    <div class="leftovers">
                        {% for field in character_creation_form %}
                            {% if field.name in  ['pack', 'material', 'main_weapon', 'secondary_weapon', 'cantrips', 'armor'] %}
                                <div id="{{ field.name + '-div'}}" class="leftovers-div">
                                    {{ field.label }}{{ field }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="character_creation_form">
                    <form id="character_creation_form" method="POST">
                            {% for field in character_creation_form %}
                                {% if field.type == 'CSRFTokenField' %}
                                    {{ field }}
                                {% endif %}
                            {% endfor %}
                        <input type="submit" class="btn" value="Create character">
                    </form>
                </div>
            </div>
        </div>

        <footer>
            <div class="footer">
                Dungeons & Dragons, D&D, their respective logos,
                and all Wizards titles and characters are property
                of Wizards of the Coast LLC in the U.S.A. and other countries.
                &copy;2017 Wizards.
            </div>
        </footer>
    </div>
</body>
</html>
